<%
top5ListingsPerMonth = function(getMonth){
        var map2 = new Map();
        for(let i in results2){
                const numDate = +Object.values(results2[i])[1];
                const date = new Date(numDate);

                if(map2.has(Object.values(results2[i])[0]) == false){
                        map2.set(Object.values(results2[i])[0], [date.getUTCMonth(), 1]);
                }
                else if(map2.has(Object.values(results2[i])[0]) == true){
                        map2.set(Object.values(results2[i])[0], [date.getUTCMonth(), map2.get(Object.values(results2[i])[0])[1]+1]);
                }
        }
        var array = [];
        for( let entry of map2.entries()){
           array.push({
                id: entry[0],
                make: "",
                month: entry[1][0],
                price: "",
                mileage: "",
                value: entry[1][1]
           });
        }
        var sorted = array.sort(function(a, b) {
           return (a.value < b.value) ? 1 : ((b.value < a.value) ? -1 : 0)
        });

        var top5 = [];
        var count = 0;
        for(let i of sorted){

                if(i.month == getMonth && count < 5){
                        top5[count] = i;

                        count++;
                }

        }
	if(top5[0] == null){
		return null;
	}
        for(let i in results){
                if(Object.values(results[i])[0] == top5[0].id){
                        top5[0].make    = Object.values(results[i])[1];
                        top5[0].price = Object.values(results[i])[2];
                        top5[0].mileage = Object.values(results[i])[3];
                }
                else if(Object.values(results[i])[0] == top5[1].id){
                        top5[1].make = Object.values(results[i])[1];
                        top5[1].price = Object.values(results[i])[2];
                        top5[1].mileage = Object.values(results[i])[3];
                }
                else if(Object.values(results[i])[0] == top5[2].id){
                        top5[2].make = Object.values(results[i])[1];
                        top5[2].price = Object.values(results[i])[2];
                        top5[2].mileage = Object.values(results[i])[3];
                }
                else if(Object.values(results[i])[0] == top5[3].id){
                        top5[3].make = Object.values(results[i])[1];
                        top5[3].price = Object.values(results[i])[2];
                        top5[3].mileage = Object.values(results[i])[3];
                }
                else if(Object.values(results[i])[0] == top5[4].id){
                        top5[4].make = Object.values(results[i])[1];
                        top5[4].price = Object.values(results[i])[2];
                        top5[4].mileage = Object.values(results[i])[3];
                }

        }
        return top5;
};
%>
